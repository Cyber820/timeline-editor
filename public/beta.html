<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç”µå­æ¸¸æˆæ—¶é—´è½´ Â· é‡å»ºç‰ˆ</title>

  <!-- ===== ä¾ç”¨æˆ·æä¾›ï¼šæ‰€éœ€æ ·å¼ä¸åº“ï¼ˆä¿ç•™ç‰ˆæœ¬å·ï¼‰ ===== -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/zh-cn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <!-- æš‚ç¼“åŠ è½½åº”ç”¨é€»è¾‘ï¼Œå¾… Step 2 æ¥çº¿
  <script type="module" src="./src/app.js"></script>
  -->

  <!-- ===== å¸ƒå±€ä¸å ä½æ ·å¼ï¼ˆé‡å»ºè„šæ‰‹æ¶ï¼‰ ===== -->
  <style>
    :root {
      --gap: 12px;
      --panel-bg: #f8f9fb;
      --border: #e5e7eb;
      --text: #111827;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; color: var(--text); background: #fff; font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; display: flex; flex-direction: column; }

    header { padding: 12px 16px; border-bottom: 1px solid var(--border); background: #fff; position: sticky; top: 0; z-index: 1000; display: flex; align-items: center; justify-content: space-between; gap: var(--gap); }
    .brand { font-weight: 700; }
    #toolbar { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    #toolbar .btn { height: 30px; padding: 0 10px; border: 1px solid var(--border); background: #fff; border-radius: 6px; cursor: pointer; }
    #toolbar .btn[disabled] { opacity: .5; cursor: not-allowed; }

    main { display: grid; grid-template-columns: 280px 1fr; gap: var(--gap); padding: var(--gap); }
    #left-panel { background: var(--panel-bg); border: 1px solid var(--border); border-radius: 10px; padding: 12px; min-height: 120px; }
    #timeline-panel { border: 1px solid var(--border); border-radius: 10px; padding: 0; min-height: 600px; display: flex; flex-direction: column; }

    /* æ¥è‡ªç”¨æˆ·æä¾›çš„ timeline ä¸ vis ç›¸å…³æ ·å¼ */
    #timeline { width: 100%; height: 800px; border: 1px solid lightgray; position: relative; }
    .vis-tooltip { white-space: normal !important; max-width: 700px !important; min-width: 300px; font-size: 10px; line-height: 1.2; padding: 12px; background-color: #fff; border: 1px solid #ccc; box-shadow: 0 0 8px rgba(0, 0, 0, 0.2); }
    .vis-item { font-size: 10px; padding: 1px 2px; background-color: #f5f5f5; border: 1px solid #aaa; border-radius: 4px; max-width: 300px; }
    #timeline .vis-item .event-title { margin: 0 !important; line-height: 1.5 !important; }

    /* é¢œè‰²é€‰æ‹© UIï¼ˆè½»é‡æ ·å¼ï¼Œä»…å½±å“é¢œè‰²æ§ä»¶ï¼‰ */
    .color-ui { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .color-ui input[type="text"] { width: 110px; padding: 2px 4px; font-size: 12px; }
    .swatches { display: flex; gap: 6px; flex-wrap: wrap; }
    .swatch { width: 18px; height: 18px; border: 1px solid #ccc; cursor: pointer; border-radius: 3px; }

    /* æ ·å¼é¢æ¿ toolbar */
    #style-window .toolbar { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    #style-window .toolbar .spacer { flex: 1; }
    #style-window .btn-ghost { background: transparent; border: 0; font-size: 18px; line-height: 1; padding: 2px 6px; cursor: pointer; color: #666; }
    #style-window .btn-ghost:hover { color: #000; }

    .section-title { font-weight: 600; margin: 8px 0; }
    .muted { color: #6b7280; font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">ç”µå­æ¸¸æˆæ—¶é—´è½´ Â· é‡å»ºç‰ˆ</div>

    <!-- Step 1ï¼šæŒ‰é’®åŸå°ä¸åŠ¨è¿ç§»åˆ°æ­¤ï¼ˆä¿æŒåŸ onclick / id / æ–‡æ¡ˆï¼‰ -->
    <div id="toolbar">
      <button onclick="openFilterWindow('and')">ğŸ” è¿‡æ»¤æ ‡å‡†</button>
      <button onclick="openStyleWindow('EventType')">äº‹ä»¶æ ·å¼</button>
      <button onclick="openStyleWindow('Platform')">å¹³å°æ ·å¼</button>
      <button onclick="openStyleWindow('ConsolePlatform')">ä¸»æœºæ ·å¼</button>
      <button onclick="openStyleWindow('Company')">å…¬å¸æ ·å¼</button>
      <button onclick="openStyleWindow('Region')">åœ°åŒºæ ·å¼</button>
    </div>
  </header>

  <main>
    <aside id="left-panel">
      <div class="section-title">ç­›é€‰å™¨ï¼ˆStep 3 å ä½ï¼‰</div>
      <div class="muted">æ­¤å¤„å…ˆä¿ç•™å®¹å™¨ï¼Œç­‰ç¬¬äºŒæ­¥æ—¶é—´è½´è·‘é€šåå†æ¥ç¬¬ä¸‰æ­¥é€»è¾‘ã€‚</div>
      <div id="filters-host"></div>

      <hr style="margin:12px 0; border:none; border-top:1px solid var(--border)" />

      <div class="section-title">æ ·å¼ï¼ˆStep 4 å ä½ï¼‰</div>
      <div class="muted">æ ·å¼ç»‘å®šã€è§„åˆ™è¡¨ä¸é¢„è§ˆç­‰åœ¨è¿™é‡Œæ¥çº¿ã€‚</div>
      <div id="styles-host"></div>
    </aside>

    <section id="timeline-panel">
      <!-- æ—¶é—´è½´å®¹å™¨ï¼šä¸æ ·å¼é…åˆä½¿ç”¨ -->
      <div id="timeline"></div>
    </section>
  </main>

  <!-- ===== å¼¹çª—åŒºï¼šæ²¿ç”¨ä½ æä¾›çš„ç»“æ„ï¼ˆç»å¯¹å®šä½ï¼‰ ===== -->
  <!-- è¿‡æ»¤é€»è¾‘è®¾ç½®å¼¹çª— -->
  <div id="filter-window" style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: #fff; padding: 20px; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: none; z-index: 2000; max-height: 80vh; overflow: auto; width: 700px;">
    <h3>è¿‡æ»¤æ ‡å‡†ï¼ˆå’Œé€»è¾‘ï¼‰</h3>
    <button onclick="openAddFilter()">å¢åŠ è¿‡æ»¤æ ‡å‡†</button>
    <button onclick="resetFilters()">å¤åŸè¿‡æ»¤æ ‡å‡†</button>
    <button onclick="applyFilters()">åº”ç”¨å’Œé€»è¾‘</button>
    <button onclick="applyFiltersOr()">åº”ç”¨æˆ–é€»è¾‘</button>
    <button onclick="document.getElementById('filter-window').style.display='none'">å…³é—­</button>
    <div id="current-filters"></div>
  </div>

  <!-- æ·»åŠ è¿‡æ»¤æ ‡å‡†å¼¹çª— -->
  <div id="add-filter-window" style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: #fff; padding: 20px; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: none; z-index: 2000; max-height: 80vh; overflow: auto; width: 700px; height: 300px;">
    <h3>æ–°å¢è¿‡æ»¤æ ‡å‡†</h3>
    <label>è¿‡æ»¤å±æ€§ï¼š<select id="filter-attribute"></select></label><br>
    <label>è¿‡æ»¤é€‰é¡¹ï¼š<select id="filter-options" multiple></select></label><br>
    <button onclick="confirmAddFilter()">ç¡®å®š</button>
    <button onclick="document.getElementById('add-filter-window').style.display='none'">å–æ¶ˆ</button>
  </div>

  <!-- å±æ€§å¤šé€‰å¼¹çª—ï¼ˆå¤ç”¨ Choicesï¼Œå¯æœç´¢ï¼Œå¯å¤šé€‰ï¼‰ -->
  <div id="attr-picker-window" style="display:none; position:absolute; top:120px; left:50%; transform:translateX(-50%); width:700px; background:#fff; border:1px solid #ccc; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.3); z-index:2100; max-height:70vh; overflow:auto;">
    <h3 id="attr-picker-title" style="margin:0 0 8px;">é€‰æ‹©åº”ç”¨çš„å±æ€§å€¼</h3>
    <div id="attr-picker-hint" style="color:#666; margin-bottom:8px;"></div>

    <div style="margin:6px 0 8px;">
      <button id="attr-picker-select-all" type="button">å…¨é€‰</button>
      <button id="attr-picker-clear" type="button">å…¨ä¸é€‰</button>
    </div>

    <div style="margin-bottom:8px;">
      <div id="attr-picker-attrname" style="margin-bottom:6px; color:#333;">å±æ€§å€¼</div>
      <select id="attr-picker-options" multiple></select>
    </div>

    <div style="margin-top:10px; text-align:right;">
      <button id="attr-picker-confirm" style="margin-right:8px;">ç¡®å®š</button>
      <button id="attr-picker-cancel">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- æ ·å¼å¼¹çª—ï¼ˆæ•´å—æ›¿æ¢å½“å‰æ•£è½æ§ä»¶ï¼‰ -->
  <div id="style-window" style="display:none; position:absolute; top:100px; left:50%; transform:translateX(-50%); width:700px; height:400px; background:#fff; border:1px solid #ccc; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.3); overflow:auto; z-index:2000;">
    <h3 id="style-title">å±æ€§æ ·å¼</h3>

    <div class="toolbar" style="margin-bottom:10px;">
      <label>è‡ªå®šä¹‰æ ·å¼ï¼š
        <select id="style-type" onchange="onStyleTypeChange()">
          <option value="none">æ— </option>
          <option value="font">å­—ä½“</option>
          <option value="fontColor">å­—ä½“é¢œè‰²</option>
          <option value="borderColor">äº‹ä»¶æ¡†é¢œè‰²</option>
          <option value="backgroundColor">äº‹ä»¶æ¡†å¡«å……è‰²</option>
          <option value="haloColor">å…‰æ™•é¢œè‰²</option>
        </select>
      </label>

      <span id="bound-type-hint" style="color:#666;">å½“å‰æ ·å¼ï¼šæ— </span>
      <span class="spacer"></span>

      <button id="style-confirm-btn" disabled>ç¡®è®¤ç»‘å®š</button>
      <button id="style-reset-btn" style="display:none;">é‡ç½®</button>
      <button class="btn-ghost" onclick="closeStyleWindow()" aria-label="å…³é—­">Ã—</button>
    </div>

    <div>
      <button id="add-style-btn" onclick="addStyleRow()" disabled>æ–°å¢æ ·å¼</button>
    </div>

    <table id="style-table" border="1" style="width:100%; margin-top:10px; border-collapse:collapse;">
      <thead>
        <tr>
          <th>æ ·å¼å†…å®¹</th>
          <th>åº”ç”¨å±æ€§</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="styleTableBody">
        <!-- åŠ¨æ€æ·»åŠ è¡Œ -->
      </tbody>
    </table>

    <div style="margin-top:10px; text-align:right;">
      <button id="style-save" type="button" class="btn-primary" onclick="confirmStyle()">ç¡®å®š</button>
      <button id="style-cancel" type="button" onclick="closeStyleWindow()">å–æ¶ˆ</button>
    </div>
  </div>

  
  <!-- ä¸´æ—¶å ä½è„šæœ¬ï¼šä»…ç”¨äº Step 1 è®©æŒ‰é’®â€œæœ‰ååº”â€ï¼ˆä¸å«ä¸šåŠ¡é€»è¾‘ï¼‰ -->
  <script>
    (function(){
      function show(id){ const el = document.getElementById(id); if(el) el.style.display = 'block'; }
      function hide(id){ const el = document.getElementById(id); if(el) el.style.display = 'none'; }

      // â€”â€” è¿‡æ»¤å¼¹çª—å ä½ â€”â€”
      window.openFilterWindow = function(mode){ show('filter-window'); };
      window.openAddFilter = function(){ show('add-filter-window'); };
      window.resetFilters = function(){ alert('å·²å¤åŸè¿‡æ»¤æ ‡å‡†ï¼ˆå ä½ï¼‰'); };
      window.applyFilters = function(){ alert('å·²åº”ç”¨ AND é€»è¾‘ï¼ˆå ä½ï¼‰'); };
      window.applyFiltersOr = function(){ alert('å·²åº”ç”¨ OR é€»è¾‘ï¼ˆå ä½ï¼‰'); };

      // â€”â€” æ ·å¼å¼¹çª—å ä½ â€”â€”
      window.openStyleWindow = function(attr){
        const el = document.getElementById('style-window');
        if(!el) return; 
        el.style.display = 'block';
        const title = document.getElementById('style-title');
        if(title) title.textContent = (attr || 'å±æ€§') + ' æ ·å¼';
        const hint = document.getElementById('bound-type-hint');
        if(hint) hint.textContent = 'å½“å‰æ ·å¼ï¼šæ— ';
      };
      window.closeStyleWindow = function(){ hide('style-window'); };
      window.addStyleRow = function(){ alert('æ–°å¢æ ·å¼ï¼ˆå ä½ï¼‰'); };
      window.confirmStyle = function(){ alert('æ ·å¼å·²ä¿å­˜ï¼ˆå ä½ï¼‰'); hide('style-window'); };

      // â€”â€” å±æ€§å¤šé€‰å¼¹çª—ï¼ˆå ä½ï¼‰ â€”â€”
      document.addEventListener('DOMContentLoaded', function(){
        const confirmBtn = document.getElementById('attr-picker-confirm');
        const cancelBtn = document.getElementById('attr-picker-cancel');
        const selAllBtn = document.getElementById('attr-picker-select-all');
        const clearBtn = document.getElementById('attr-picker-clear');
        const picker = document.getElementById('attr-picker-window');
        if(confirmBtn) confirmBtn.addEventListener('click', function(){ alert('å·²é€‰æ‹©ï¼ˆå ä½ï¼‰'); if(picker) picker.style.display = 'none'; });
        if(cancelBtn) cancelBtn.addEventListener('click', function(){ if(picker) picker.style.display = 'none'; });
        if(selAllBtn) selAllBtn.addEventListener('click', function(){ alert('å…¨é€‰ï¼ˆå ä½ï¼‰'); });
        if(clearBtn) clearBtn.addEventListener('click', function(){ alert('å…¨ä¸é€‰ï¼ˆå ä½ï¼‰'); });
      });
    })();
  </script>
</body>
</html>
